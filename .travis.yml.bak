dist: bionic

language: generic

cache:
  pip: false
  directories:
  - "$HOME/db/"

env:
  global:
  - GIT_NAME: Spirillen
  - GIT_EMAIL: 44526987+spirillen@users.noreply.github.com
  - TRAVIS_REPO_SLUG: "${TRAVIS_REPO_SLUG}"
  - GIT_BRANCH: "${TRAVIS_BRANCH}"
  - TZ: UTC
  - PYTHON_VERSION: 3.8.5
  - SCRIPT_SOURCE_URI: 'https://raw.githubusercontent.com/dns-test/script-hub/master'
  - Pyfunceble_version: 'PyFunceble@raw2sqlalchemy'
  - PYFUNCEBLE_CONFIG_DIR: "${TRAVIS_BUILD_DIR}/.pyfunceble/"
  - PYFUNCEBLE_OUTPUT_LOCATION: "${TRAVIS_BUILD_DIR}/.pyfunceble/"
  - PYFUNCEBLE_AUTO_CONFIGURATION: yes
  #- PYFUNCEBLE_DB_CHARSET="${DB_CHARSET}"
  #- PYFUNCEBLE_DB_HOST="${DB_HOST}"
  #- PYFUNCEBLE_DB_NAME="${DB_NAME}"
  #- PYFUNCEBLE_DB_USERNAME="${DB_USERNAME}"
  #- PYFUNCEBLE_DB_PASSWORD="${DB_PASSWORD}"
  #- PYFUNCEBLE_DB_PORT="${DB_PORT}"
  - secure: "aNqpPLMFWrgmaYRnp0gyX6cVlHMHJ1xrL8cb/0m3hP+jREOu6r4YaGCysGTrkwbHSPxLcQrrLsaRuNBoZKvODEiT+csL1vfjGesTsbZ9jLR9ld0QW0rb0SxwRZ6g0m7DTDRkgWpHTxPbad2IlE/DxMQ6lf0T3rdqwmeSpRAduj50b2fGP+wPJHNF5vUQCEjrZFonE3H3cXKPv8uFcq8cALc90ensXmkaWndMdUaqCBVmPMG7goVEQ5eKH2PLH/+/DG/hhRi6YV2b4WL5r9zUDT598OGOkB9BdZeJlx7uQScUT8YRpoYTqYDXT2QTyMOoAqgIgF4GVw5gB0Y5LTWNMXNrSfuOhbRy09grjIg7fSVTdAmaefZAR9+5X0o+pxz6BmwocfrfwfDVVb/GcNjNAyQ7b0gdnnxvc0DyYPJAvpXCzyIm63KZYSKP+BjJ3kJGQgkCxtdALhbyz5KydDCFOrP7kq4udK5L/bTfGRkRuHV6gJkfpg8HjY0NjmytebR+cpFqEK9VGTkFXpIFPNsfCrt9McG9U9NaARAv9lpite2H0n8rUqUROhx+mRw2H7/he/WcHJTvFt0V1M2EQzIti7AoRZLKPQanOnBDfWyopNUeUsSSNYx/K9p78733zhbsawhDiB+k9CcKTBrRyscph0g/pd6WKrnWgQjxu12BFXY="
  # DB_CHARSET
  - secure: "hK/QtuE0BG5p8LEGjzrP43ji7txIdWmLIL94z6b6/EZgabxlXM9P2XK+lDJ/WNooL96GTLrbFgPfaYfkohqdrxcIiadcR+jRM8Uk/FIJ9QQqujiunfJaV8C9mQqbFZAuQeS0/mbFOUFaThpUjG3Ezc4cYQql78U1CyS/YcY8jw5Wci7vqk2l7sxdAo/laMk1suHAhv+DHUQs0z181NKgenfeZXcNYR1dDrPwZLfsRob+MiKt52t+O9PxWeTxGXfmCwEMCBlBolnsf0JDwY1VFUNsCh8A9Jofz+VfAqZt9s5ZeQ8WZnSGeNhb9elpHXDk7iewOzCSI1yhb6QeVoz40nWHv69FX368Ha/0iDmFryC/a5RZ/mOe2P/v1cYJrOtSBh5G4/Z1CqNDTCJMQ1tKkz6Ph4iU7OeqqFCzV5DMAjHyEt98W68NK7nEW2SlXDJgRPFk4tyCNOg89/CXSiidKq6uN4nvLYBfgxQDjUUJa8nX8dH9iBKTYkP1CQVBxgPFKc8l4zQxv9FBluE7rVpgma7W9sOiAw6jiDlfraaTLfQyzb8YAKxEN+On3VwFzW1kL7sqWIuT3t8OksDSd0BOI6u9Bl7fu3ZB+bH6Hko8yzioah8hROfWKT4ExZXN3EDZDLMP/VbyTfYhO2Kd5WH9df4Ey35mLTmK7KZP9jCsN60="
  # DB_HOST
  - secure: "d/E1RIcxMbT+UyJfNpzz1IpX2rFeI8FzCUew1vllLewI4JI6SCdq2GApfOGLjrPjA96/ob6Rwq8gWYKqaxk/JUGNsJzgNxHYrxQu4wEipkow34zlYvftHe9RrXmep3/HJNH3vTE8b00CGX4h/82Y78fgQe4r1FCri6j6QyTd7fVJGxbSC3mSZo3yFNR0QIwYakkegT4yEMJRNjIDTC39Rb96jQD6kp4coEGNeZ3KUX/VYdp/qdSbmaGJ6wrWuCZu9R/6Hb80Bw77o5v7hDE83CoFx9EREj+lypQaP3fTmFdJXC/T5K6zgrsQho7aF8/tZMBWRvkwYuvIj2XA4NFtwAACxq0Ne2dH808lkOOtjqsD/jiII6jB/m8nuVo7vqVuoVPdRqJ7IVHm5NUmYssEomFZ2bpG3qJ3JUiW7XVXt/TOh/vxtyNfhYZsyhbTd1qAWiFyxdLomFVIMbKMd01ZfJ20cEET4HUiCrz4tI/WQKvhmb05oQGZUr+17QgzY+tJ109XNa91nuwPboc2nYVEoswmg7N5ULiO2WMt3BY9NiU9g4Oz9VFJi6tbaDDSc4a9DsBJF6KFN11nPsrA1rnMDCsFGDTiRZdD84E7Vi3+dQ0Lze2KZYhSftEpJSlEAIWuPC1HwNAmH5OqKpGmjonfVvdr/pZnYYHBPvl2E8aDcUg="
  # DB_NAME
  - secure: "gz+nAgIDn2XIlayyteSysTnz4yBqtLIhwKf0fHDdf9PJsQwGsVoofCVWbrRErYvBxawqA0djp4jQfZ61h4IB8Him5k8FztDvFyoIExuSDjjsGgW0fHRXNz9N5YXksAus7yHthQxAHnLzXq74lZ8Mu1cc19FoBgS0WzRofUN9dLCsudJzgBLBf8TfvhJyPADBWG/dwURzgwoFVXYgoS5UCfaMs6K3n6WHwp8nmnP309V8CH8vwSr94Xu9ydOMqCpm7ms25kF7TfB/jULjSGHqnplk7Q5YYWjgcQ6K7j56yz+6gvojkYldacM2tgAA4XEChS4It11/KNS911lhOLE1rYrIkAjB9+/8DZ1NpXaQtq6gkQ1d9aJTCjmd3rNV36bJr7wzZ5qmU/UObdrB8pksgVJEtD5uLLcehcYS7p2fpqegfwE2yIJMsa9Vp6wDBTQ812ku91JDWEm0ykmIW2nN8ot7uVnT5wvTp9jakkJ/gcVV35lct5Br9fwaj2OeYe24hcr5TcpMS8C2a3X25gvK8TOUpzXL8aLQS2V7bsagXLbsZqcfjot8z1t2uwVSeF03Iv0Ed30Do8LNdSsChFFDvVrQWeiRQMiUaHm6bxoL2tP6paBSTmrlvT1j/I7QEUQ321io0YzSvbs+PE7aT8n0okhzlhnfegDOzWL+dSGEGwc="
  # DB_USERNAME
  - secure: "PzJXYAjfLBkIPdoFbfmAxi12FkV1c0wahF2VZF758PqfREqUNDmnAe1xxMEbUr9RfH6AHaDQTawjdY9wo8+EeOOQq9TvoF5uA3Tj45vacreGcQqOZWjVSldbI09zqfVJ1kmea9WeqF4nrkbMPnFD3szhMWob8Q0rKDVCY+QmSA81BapR+uWu5C0mYLw3Kv2LWDkon6/xGVqDdau7f0M2TLgxrBOUhY/dwQvU937DEMzCRHccKS87WxNM5Axn51ZSzwDymaAZiWkJBiEPeNSyFVjtJ+euO4vkGPcDiZlcpQmadyz7KCc41qy3twbsoJZBY5HCTaiQSNuRkbHahXtlym+47b5/pBszlSsh0yqRAc1udktgUHol63zMW+o/UVZegpeIl2u7hwoXhZ/EdzeFAVwFJXllSADC+/dagYWUGSykFp6y7EpBMpz9XZJMMWH3yCjrbM4Xum0OkaSD/nvinb9ApSPuuj7hLZEHW/SwpbAbkvS1tm1r+3lcW2Y//KhfOqm2/+ip7MXItohuzOpUexRohi0f3RigmiZwloMqWJb731I3mfdKwA7vYLrocGpvDMijtBgkjK0x4NS2CHMd11piIVVLWSF7GKT1qp0SIYSSkKHYAQq9WCOsbI/ewRLdy9pH894wHzzgbGPeMfYLBL3tsoOuIvlL3aiEgeemSyo="
  # DB_PASSWORD
  - secure: "oJqWwTyhWOpCu+a6oe28o5UsE5e2sewdJoch9SJw4r/frYyUcu8ZG1FNmKurx+b1LkVv6SpYCLdlNJ0eyZROilCYVcclDmtN8h7egBFi2IiYJSTn/YcPNx96uGE5kcaOWBOL6489c1X2Jc37w0wvTsHFSxwcgYDRiuyEtwFgXHNgdrxpC5hjLr5Pp6z3uRvIY3yUbQQ4sdRZ73NSv43toVE+eTiZx21IxbCA7BdJezPTLmkSYUsfBLjPfs6RgLOkCpfixDaWQQaCNnR9O3tz1bKKcIb+7pIV9PMHCorE57XWInRPKTROU/+padP+lFsqnXotBrUyWYhW5jer48QnUWk9jWNwBYJHWCiAC41ZTlBcR9hvPz7Kv10g2MOmyIeIvMEVqIw/Z5f8o86bh8U9Ldh3ITscl6CcWzGzqZmbDjYsV0XP8t3OCM6ImXEZOlAsxaFixYzpC3D2uVumqbi0uu8NK2yNgKhXUu6EaPwIpM5WLlCCD6wrX3KB6MYcCf1df7i3Lo4m77mCdc7imcn4VEFht1GeuAo3Rm539+qc8m3dTY9ZENi0phGgyqwxYFsU8rWSxFGEkBMLOkrEb423fgK5mj53pFTTPBAmxHtz6VNxd+TpKTbZELiLWJiwfnotQJo4DJaIBPCFShLSS9sfCI98Z2TjsjJR/852sRGHkfk="
  # DB_PORT
  - secure: "WV2zzzjW8VSyCNxJEF0JHbooBRQoJL1rBvBzD8CUHUp7AHAUXWuTeuuussPm9PsZ6k/KYSEVsRmhZNDVxcUOk/cCIlaU9ILK8wQZwwFwoX8IV93WSaeHVtsahnC3iwKL8LATFJVMBXrOOZVwMUQAfYNZ8jzj30rXvYOo5F6EPasGZLEqwaHbtyIBGdDYi8GgtsyNLG2V17DfFuPG6lN5Q2G6F2MWLLge/pWVUrnMAOPXmTUZ4rJivWQVtih3zLiosskehy24Oup6FkedjcWkCCmDDTf0rFxEOW21V1fG+Y+W96GzOcHg+qVjuMgZjczqunLmr0ZWnoj7mNXqcTufzqXy8TZDWWggxovgoPwwijnXm/93gLlo6BhfaQmr2QW5BbGXbKQZiPzHtqMkYym125P0ALo1KsLw9k3HVXuctbAAClQscc7r11rXEbDZa1iU9fik2IIKs0ZsmvSpaeZPISidJeJoUyyrQUc/pWQZgGenzvSysBEkRrrP9v+RUDPR93bEPD2qHdKUtKGsspR/2x6BNuG+Hy8zMYEI1AYeZLnowOUhB2BafZnuQ/uPh6QQzKx4JNZwc5kjMHUA/fdxiFwxc8IkWQVzg/My3OoY+HoPNXLSETF10vs9j3Q50sK+feqTcFMNDyGt/xvCnpPRyAlw3OHqZS2UssEpFB+Gbvk="

# We needs the mariadb client...
#addons:
#  mariadb: '10.5'

install:
  - export PATH="${HOME}/miniconda/bin:${PATH}"
  - if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then wget https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh; else wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh; fi
  - bash miniconda.sh -b -p ${HOME}/miniconda
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda config --add channels conda-forge
  - conda update -q conda
  - conda create -q -n test-environment python="${PYTHON_VERSION}"
  - source activate test-environment
  - python --version --version
  - pip --version
  - conda --version
  - pip install --no-cache-dir -U dnspython[dnssec,idna]
  - pip install --no-cache-dir -U "git+https://github.com/funilrys/${Pyfunceble_version}"
  - pyfunceble --version
  - wget -O "${TRAVIS_BUILD_DIR}/setup_travis.sh"
    "${SCRIPT_SOURCE_URI}/travis/setup_travis.sh" &&
    sudo chmod +x "${TRAVIS_BUILD_DIR}/setup_travis.sh"
  - sudo bash "${TRAVIS_BUILD_DIR}/setup_travis.sh"

git:
  depth: 2

script:
  - truncate -s 0 "${TRAVIS_BUILD_DIR}/run_id"
  - echo "${TRAVIS_JOB_ID}" > "${TRAVIS_BUILD_DIR}/run_id"
  - cat "${TRAVIS_BUILD_DIR}/run_id"
  - bash "${TRAVIS_BUILD_DIR}/dns-test.sh"
